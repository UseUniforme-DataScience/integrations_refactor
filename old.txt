app.MapGet(
        "/api/orders/{id:long}",
        async (
            long id,
            IShopifyOrderService orderService,
            IShopifyOrderRepository orderRepository,
            CancellationToken ct
        ) =>
        {
            var order = await orderService.GetOrderByIdAsync(id);
            var jsonOptions = new JsonSerializerOptions
            {
                Encoder = JavaScriptEncoder.UnsafeRelaxedJsonEscaping,
            };
            var shopifyOrder = new ShopifyOrder
            {
                Id = order!.Id,
                Cpf = "12345678901",
                AdminGraphqlApiId = order.AdminGraphqlApiId,
                AppId = order.AppId,
                BrowserIp = order.BrowserIp,
                BuyerAcceptsMarketing = order.BuyerAcceptsMarketing,
                CancelReason = order.CancelReason,
                CancelledAt = order.CancelledAt,
                CartToken = order.CartToken,
                CheckoutId = order.CheckoutId,
                CheckoutToken = order.CheckoutToken,
                ClientDetails = JsonSerializer.Serialize(order.ClientDetails, jsonOptions),
                ClosedAt = order.ClosedAt,
                ConfirmationNumber = order.ConfirmationNumber,
                Confirmed = order.Confirmed,
                ContactEmail = order.ContactEmail,
                CreatedAt = order.CreatedAt,
                Currency = order.Currency,
                CurrentSubtotalPrice = order.CurrentSubtotalPrice,
                CurrentSubtotalPriceSet = JsonSerializer.Serialize(
                    order.CurrentSubtotalPriceSet,
                    jsonOptions
                ),
                CurrentTotalAdditionalFeesSet = JsonSerializer.Serialize(
                    order.CurrentTotalAdditionalFeesSet,
                    jsonOptions
                ),
                CurrentTotalDiscounts = order.CurrentTotalDiscounts,
                CurrentTotalDiscountsSet = JsonSerializer.Serialize(
                    order.CurrentTotalDiscountsSet,
                    jsonOptions
                ),
                CurrentTotalDutiesSet = JsonSerializer.Serialize(
                    order.CurrentTotalDutiesSet,
                    jsonOptions
                ),
                CurrentTotalPrice = order.CurrentTotalPrice,
                CurrentTotalPriceSet = JsonSerializer.Serialize(
                    order.CurrentTotalPriceSet,
                    jsonOptions
                ),
                CurrentTotalTax = order.CurrentTotalTax,
                CurrentTotalTaxSet = JsonSerializer.Serialize(
                    order.CurrentTotalTaxSet,
                    jsonOptions
                ),
                CustomerLocale = order.CustomerLocale,
                DeviceId = order.DeviceId,
                DiscountCodes = JsonSerializer.Serialize(order.DiscountCodes, jsonOptions),
                DutiesIncluded = order.DutiesIncluded,
                Email = order.Email,
                EstimatedTaxes = order.EstimatedTaxes,
                FinancialStatus = order.FinancialStatus,
                FulfillmentStatus = order.FulfillmentStatus,
                LandingSite = order.LandingSite,
                LandingSiteRef = order.LandingSiteRef,
                LocationId = order.LocationId,
                MerchantBusinessEntityId = order.MerchantBusinessEntityId,
                MerchantOfRecordAppId = order.MerchantOfRecordAppId,
                Name = order.Name,
                Note = order.Note,
                NoteAttributes = JsonSerializer.Serialize(order.NoteAttributes),
                Number = order.Number,
                OrderNumber = order.OrderNumber,
                OrderStatusUrl = order.OrderStatusUrl,
                OriginalTotalAdditionalFeesSet = JsonSerializer.Serialize(
                    order.OriginalTotalAdditionalFeesSet,
                    jsonOptions
                ),
                OriginalTotalDutiesSet = JsonSerializer.Serialize(
                    order.OriginalTotalDutiesSet,
                    jsonOptions
                ),
                PaymentGatewayNames = JsonSerializer.Serialize(
                    order.PaymentGatewayNames,
                    jsonOptions
                ),
                Phone = order.Phone,
                PresentmentCurrency = order.PresentmentCurrency,
                ProcessedAt = order.ProcessedAt,
                Reference = order.Reference,
                ReferringSite = order.ReferringSite,
                SourceIdentifier = order.SourceIdentifier,
                SourceName = order.SourceName,
                SourceUrl = order.SourceUrl,
                SubtotalPrice = order.SubtotalPrice,
                SubtotalPriceSet = JsonSerializer.Serialize(order.SubtotalPriceSet, jsonOptions),
                Tags = order.Tags,
                TaxExempt = order.TaxExempt,
                TaxLines = JsonSerializer.Serialize(order.TaxLines, jsonOptions),
                TaxesIncluded = order.TaxesIncluded,
                Test = order.Test,
                Token = order.Token,
                TotalCashRoundingPaymentAdjustmentSet = JsonSerializer.Serialize(
                    order.TotalCashRoundingPaymentAdjustmentSet,
                    jsonOptions
                ),
                TotalCashRoundingRefundAdjustmentSet = JsonSerializer.Serialize(
                    order.TotalCashRoundingRefundAdjustmentSet,
                    jsonOptions
                ),
                TotalDiscounts = order.TotalDiscounts,
                TotalDiscountsSet = JsonSerializer.Serialize(order.TotalDiscountsSet, jsonOptions),
                TotalLineItemsPrice = order.TotalLineItemsPrice,
                TotalLineItemsPriceSet = JsonSerializer.Serialize(
                    order.TotalLineItemsPriceSet,
                    jsonOptions
                ),
                TotalOutstanding = order.TotalOutstanding,
                TotalPrice = order.TotalPrice,
                TotalPriceSet = JsonSerializer.Serialize(order.TotalPriceSet, jsonOptions),
                TotalShippingPriceSet = JsonSerializer.Serialize(
                    order.TotalShippingPriceSet,
                    jsonOptions
                ),
                TotalTax = order.TotalTax,
                TotalTaxSet = JsonSerializer.Serialize(order.TotalTaxSet, jsonOptions),
                TotalTipReceived = order.TotalTipReceived,
                TotalWeight = order.TotalWeight,
                UpdatedAt = order.UpdatedAt,
                UserId = order.UserId,
                BillingAddress = JsonSerializer.Serialize(order.BillingAddress, jsonOptions),
                Customer = JsonSerializer.Serialize(order.Customer, jsonOptions),
                DiscountApplications = JsonSerializer.Serialize(
                    order.DiscountApplications,
                    jsonOptions
                ),
                Fulfillments = JsonSerializer.Serialize(order.Fulfillments, jsonOptions),
                LineItems = JsonSerializer.Serialize(order.LineItems, jsonOptions),
                PaymentTerms = JsonSerializer.Serialize(order.PaymentTerms, jsonOptions),
                Refunds = JsonSerializer.Serialize(order.Refunds, jsonOptions),
                ShippingAddress = JsonSerializer.Serialize(order.ShippingAddress, jsonOptions),
                ShippingLines = JsonSerializer.Serialize(order.ShippingLines, jsonOptions),
            };
            Console.WriteLine("\n\nFinalizada a conversão para o entity");
            await orderRepository.AddOrderAsync(shopifyOrder, ct);
            return Results.Ok(shopifyOrder);
        }
    )
    .WithName("GetOrder");

app.MapGet(
        "/api/local/{id:long}",
        async (long id, IShopifyOrderRepository orderRepository, CancellationToken ct) =>
        {
            var order = await orderRepository.GetOrderByIdAsync(id, ct);

            return Results.Ok(order);
        }
    )
    .WithName("GetLocalOrder");

app.MapPut(
        "/api/orders/{id:long}",
        async (
            long id,
            ShopifyOrderDto order,
            IShopifyOrderService orderService,
            CancellationToken ct
        ) =>
        {
            if (order.Id != id)
                return Results.BadRequest(
                    new { error = "Id da rota não corresponde ao id do pedido." }
                );
            var updated = await orderService.UpdateOrderAsync(order, ct);
            return Results.Ok(updated);
        }
    )
    .WithName("UpdateOrder");